from uaclient import messages
from uaclient.api.u.pro.security.vulnerabilities._common.v1 import (
    VulnerabilityData,
)
from uaclient.cli.commands import ProCommand


def action_update(args, *, cfg, **kwargs):
    print(messages.CLI_VULNERABILITY_UPDATE_CHECK_NEW_DATA)

    vulnerability_data = VulnerabilityData(cfg)
    cache_valid, _ = vulnerability_data.is_cache_valid()

    if not cache_valid:
        print(messages.CLI_VULNERABILITY_UPDATE_NEW_DATA_FOUND)
        vulnerability_data.get()
        print(messages.CLI_VULNERABILITY_UPDATE_DATA_UPDATED)
    else:
        print(messages.CLI_VULNERABILITY_UPDATE_NO_NEW_DATA_FOUND)


update_subcommand = ProCommand(
    "update",
    help=messages.CLI_VULNERABILITY_UPDATE,
    description=messages.CLI_VULNERABILITY_UPDATE_DESC,
    action=action_update,
    preserve_description=True,
)
